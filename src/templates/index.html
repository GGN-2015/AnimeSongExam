<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AnimeSongExam</title>
    <link href="/static/bootstrap-5.3.3-dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
</head>
<body>
    <div class="container-md">
        <h1>基于听歌识曲的二次元浓度测试</h1>
        <hr>
        <h2>设置</h2>
        <hr>
        <h2>问答</h2>
            <audio controls>
                <source src="/audio/{{ answer.file }}" type="audio/mpeg">
                您的浏览器不支持 audio 模块
            </audio>
            <ul class="list-group">
                {% for option in options %}
                    <li class="list-group-item list-group-item-action one-of-the-options" data-file="{{ option.file }}" onclick="check_answer('{{ option.file }}')">{{ option.tag }}</li>
                {% endfor %}
            </ul>
        <hr>
        <p>powered by flask, <a href="https://github.com/GGN-2015">GGN_2015</a></p>

        <!-- Button trigger modal -->
        <button id="modal-trigger-button" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" style="display: none;">
            Launch demo modal
        </button>
        
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">消息</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="my-message-box-content">...</p>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="/static/bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script>
        var answer_checked = false;
        function recolor_correct_answer(answer_file, myanswer) { // 为正确答案标记颜色
            var option_buttons = document.getElementsByClassName("one-of-the-options");
            for(var i = 0; i < option_buttons.length; i += 1) {
                if(option_buttons[i].dataset.file == answer_file) { // 标记正确答案
                    option_buttons[i].classList.add("list-group-item-success");
                }else {
                    if(option_buttons[i].dataset.file != myanswer ) {
                        option_buttons[i].classList.add("list-group-item-secondary"); // 将所有不是正确答案的选项标成灰色
                    }
                }
            }
        }
        function send_message(msg) { // 发送一个 modal
            var msg_box = document.getElementById("my-message-box-content");
            msg_box.innerHTML = msg.toString();
            var msg_button = document.getElementById("modal-trigger-button");
            msg_button.click();
        }
        function recolor_wrong_answer(myanswer) {
            var option_buttons = document.getElementsByClassName("one-of-the-options");
            for(var i = 0; i < option_buttons.length; i += 1) {
                if(option_buttons[i].dataset.file == myanswer) { // 标记错误答案
                    option_buttons[i].classList.add("list-group-item-danger");
                }
            }
        }
        function check_answer(myanswer) { // 检查答案是否正确
            if(!answer_checked) {
                var answer_file = "{{ answer.file }}";
                recolor_correct_answer(answer_file, myanswer);
                if(myanswer == answer_file) {
                    send_message("回答正确");
                }else {
                    send_message("回答错误<br>正确答案：{{ answer.tag }}");
                    recolor_wrong_answer(myanswer); // 标记错误答案
                }
            }
            answer_checked = true;
        }
    </script>
</body>
</html>